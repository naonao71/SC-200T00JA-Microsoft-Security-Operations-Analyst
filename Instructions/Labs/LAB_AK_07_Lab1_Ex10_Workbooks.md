---
lab:
    title: '演習 10 - ワークブックを作成する'
    module: 'Learning Path 7 - Create detections and perform investigations using Microsoft Sentinel'
---

# ラーニング パス 7 - ラボ 1 - 演習 10 - ワークブックを作成する

## ラボのシナリオ

あなたは、Microsoft Sentinel を実装した会社で働くセキュリティ運用アナリストです。データ ソースを Microsoft Sentinel に接続すると、カスタム ダッシュボードを作成する際の汎用性を提供する Azure Monitor ブックの Microsoft Sentinel を使用して、データを視覚化および監視できます。

Microsoft Sentinel を使用すると、データ全体にカスタム ブックを作成でき、データ ソースに接続するとすぐにデータ全体の分析情報をすばやく取得できる組み込みのブック テンプレートも付属しています。


### タスク 1: ブック テンプレートを調べる

このタスクでは、Microsoft Sentinel ブック テンプレートについて調べます。

1. 管理者として WIN1 仮想マシンにログインします。パスワードはPa55w.rd です。

1. Microsoft Edge ブラウザーで Azure portal (https://portal.azure.com) に移動します。

1. サインイン ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供されたテナントのメール アカウントをコピーして貼り付け、「次へ」を選択します。

1. パスワードの入力ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供されたテナントパスワードをコピーして貼り付け、「サインイン」を選択します。

2. Azure portal の検索バーに「Sentinel」と入力してから、「Microsoft Sentinel」を選択します。

3. Microsoft Sentinel ワークスペースを選択します。

4. **ブック** を選択します。既定では、**テンプレート** タブが選択されています。

5. 「**IDおよびアクセス**」 テンプレートブックを検索して選択します。右側のウィンドウで、「**テンプレートの表示**」ボタンをクリックします。

6. ブックの内容を確認します。セキュリティ ログを収集および分析し、監査ログとサインイン ログを使用して Microsoft 製品の使用に関する分析情報を収集することで、ID およびアクセス操作に関する分析情報を示します。

7. 右上隅にある 「X」 を選択してブックを閉じます。


### タスク 2: ブック テンプレートの保存と変更

この作業では、ワークブック テンプレートを保存して変更します。

1. 「Microsoft Sentinel - ブック - テンプレート」タブに戻ります。Azure AD 監査ログを検索して選択し、右側のウィンドウで 「**保存**」 ボタンをクリックします。
   
2. リージョンの既定値として 「**East US**」 のままにして、「**OK**」 を選択します。

3. 「**保存されたブックの表示**」 ボタンをクリックします。

4. コマンド バーで 「**編集**」 を選択して、ブックの変更を有効にします。

5. *User activities* エリアまで下にスクロールして、"Operations count" と "Trend" のグラフの色を確認します。これらの列のフォーマットを変更するので、グリッドの下の 「**編集**」 ボタンをクリックします。

6. 「**クエリの実行**」 コマンド バーの右側にある 「**列の設定**」 ボタンを選択します。ヒント：このボタンは、KQL クエリのデータがある場合にのみ表示されます。

7. *列の設定の編集* ブレードが表示されるので、*列* の 「**Operations Count (ヒートマップ + 書式付き)**」 を選択します。

8.  設定項目を確認します。特に **列レンダラー** のオプションを確認します。「**カラーパレット**」 で 「**32色（カテゴリ別）**」 を選択します。

9.  *列* の 「**Trend (スパークライン + 書式付き)**」 を選択します。

10. 設定項目を確認します。特に **列レンダラー** のオプションを確認します。「**カラーパレット**」 で任意の色を選択します。

11. 「**保存して閉じる**」 をクリックします。次に、1 つのタイル/グリッド コントロールを使用して、別のタイル/グリッドの結果をフィルター処理する方法について説明します。

12. 「**クエリ 項目を編集しています:query - 2**」 のコマンド バーにある 「**詳細設定**」 ボタンを選択します。

13. 「**項目が選択されている場合、パラメーターをエクスポートする**」 チェックボックスの設定を確認します。パラメーターとして *UserInfo* フィールドが選択されていることを確認します。

14. 下にスクロールして、クエリの下部 (上部のメニューではない) にある「**編集が完了しました**」 をクリックします。*Operations count* と *Trend* の変更された色を確認します。

15. 画面の右側にある *Top active users* の円グラフの下にある 「**編集**」 を選択します。 

16. ログ クエリで、*UserInfo* を見つけます。クエリは、他のクエリからエクスポートされたパラメーターを使用して結果をフィルター処理しています。

17. 下にスクロールして、クエリの下部 (上部のメニューではない) にある 「**編集が完了しました**」 をクリックします。

18. 上にスクロールして、トップメニューで 「***編集が完了しました**」 を選択し、「**保存**」 アイコンを選択します。右上隅にある 「**X**」 を選択してブックを閉じます。

### タスク 3: ブックの作成

このタスクでは、高度な視覚エフェクトを含む新しいワークブックを作成します。

1. Microsoft Sentinel ポータルの 「**ブック**」 エリアに戻ります。

1. 「**+ ブックの追加**」 を選択して、新しいブックを最初から作成します。 

    >**ノート:** 新しいブックですが、スタートアップテンプレートが使用されます。

1. ブックを編集するには、「**編集**」 を選択します。

1. ブックの最初の段落の下にある 「**編集**」 ボタンを選択します。

1. *## New workbook* の上に、新しい行として 「*# My workbook*」 を入力します。

1. 「**テキスト 項目を編集しています:text - 2**」 の下にあるメニューで、「**編集が完了しました**」 をクリックします。ヘッダーのサイズが大きくなり、名前が変更されたことに注意してください。

1. 表示されている棒グラフの下にある 「**編集**」 を選択します。

1. *union* 演算子で全てのテーブルを取得し、集約してカウントするKQLクエリを確認します。

1. 「**クエリ 項目を編集しています:query - 2**」 の下にあるメニューで、「**編集が完了しました**」 をクリックします。

1. 棒グラフの 「**編集**」ボタンの横にある省略記号 「...」 を選択し、「+ 追加」 を選択してから、「クエリの追加」 を選択します。

1. ログクエリに **SecurityEvent** を入力します。

1. 「時間の範囲」をドロップダウンリストから 「**過去時間**」 に変更します。

1. 「視覚化」をドロップダウンリストから 「**時間グラフ**」 に変更します。

1. クエリのコマンド バーから 「**スタイル**」を選択します。

1. 「**この項目をユーザー設定の幅にします**」チェックボックスをチェックします。

1. 「*パーセント幅*」 を 「**25**」 に、「*最大幅*」 を 「**25**」 に設定します。

1. クエリのコマンド バーから 「**詳細設定**」 を選択します。

1. 「**編集中でないときに更新アイコンを表示する**」 チェックボックスをチェックします。

1. 「**クエリ 項目を編集しています:クエリ - 2**」 の下にあるメニューで、「**編集が完了しました**」 をクリックします。

1. 下にスクロールし、ブックの下部にある 「+ 追加」、「クエリの追加」の順に選択します。

1. ログクエリに **SecurityEvent** を入力します。

2. 「時間の範囲」をドロップダウンリストから 「**過去時間**」 に変更します。

3. 「視覚化」をドロップダウンリストから 「**グリッド**」 に変更します。

4. クエリのコマンド バーから 「**スタイル**」 を選択します。

5. 「**この項目をユーザー設定の幅にします**」 チェックボックスをチェックします。

6. 「*パーセント幅*」 を 「**75**」 に、「*最大幅*」 を 「**75**」 に設定します。

7. 「**クエリ 項目を編集しています:クエリ - 3**」 の下にあるメニューで、「**編集が完了しました**」 をクリックします。

8. ワークブックの上部のコマンド バーで 「**編集が完了しました**」 を選択します。

9. 「**保存**」 アイコンを選択し、「タイトル」を 「**My Workbook**」 に変更します。

10. リソースグループに 「**RG-Defender**」 を選択し、その他の値は既定値のままにします。

11. 「**適用**」 をクリックします。 

12. 右上の 「X」 を選択してブックを閉じるか、Microsoft Sentinel ポータルで 「ブック」 を選択します。

13. 「ブック」ページに戻り、「マイブック」タブを選択します。

14. 作成した **My workbook** を選択します。

15. 右側のウィンドウで、**保存されたブックの表示** をクリックしてブックを確認します。

## 演習 11 に進みます。
